
<form name="container-form" class='mt-3' method="POST" action="/courses/handle-form-actions">
   <h3>Khóa học của tôi</h3>
   <a href='/me/trash/courses'>Thùng rác</a>
   <span>{{deletedCount}}</span>

   <div class="mt-3 mb-3 d-flex gap-2 align-items-center">
      <div class="form-check">
         <input class="form-check-input" type="checkbox" value="" id="checkbox-all">
         <label class="form-check-label" for="checkbox-all">
            Chọn tất cả
         </label>
      </div>
      <select class="form-control form-control-sm checkbox-select-all-options" name="action" required>
         <option value="">---- CHỌN HÀNH ĐỘNG ----</option>
         <option value="delete">Xóa</option>
      </select>
      <button class="btn btn-primary btn-sm disabled btn-submit">Thực hiện</button>
   </div>


   <table class='table'>
      <thead>
         <tr>
            <th scope='col'>#</th>
            <th scope='col'>Tên khóa học</th>
            <th scope='col'>Mô tả</th>
            <th scope='col' colspan='2'>Thời gian tạo</th>
         </tr>
      </thead>
      <tbody>
         {{#each courses}}
            <tr>
               <td>
                  <div class="form-check">
                     <input type="checkbox" class="form-check-input" value="{{this._id}}" name="courseIds[]">
                  </div>
               </td>
               <th scope='row'>{{sum @index 1}}</th>
               <td>{{this.name}}</td>
               <td>{{this.description}}</td>
               <td>{{this.createdAt}}</td>
               <td>
                  <a href='/courses/{{this._id}}/edit' class='btn btn-link'>Sửa</a>
                  <a
                     type='button'
                     class='btn btn-primary'
                     data-bs-toggle='modal'
                     data-bs-target='#delete-course-modal'
                     data-id={{this._id}}
                  >Xóa</a>
               </td>
            </tr>
         {{else}}
            <tr>
               <td colspan='5' class='text-center'>Không có khóa học nào
                  <a href='/courses/create'>Thêm khóa học</a>
               </td>
            </tr>
         {{/each}}
      </tbody>
   </table>

</form>

{{! Confirm Delete Modal }}

<div id='delete-course-modal' class='modal' tabindex='-1'>
   <div class='modal-dialog'>
      <div class='modal-content'>
         <div class='modal-header'>
            <h5 class='modal-title'>Modal title</h5>
            <button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button>
         </div>
         <div class='modal-body'>
            <p>Xác nhận xóa Khóa học</p>
         </div>
         <div class='modal-footer'>
            <button id='btn-delete-course' type='button' class='btn btn-danger'>Xóa bỏ</button>
            <button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Hủy</button>
         </div>
      </div>
   </div>
</div>

{{! Delete Hidden Form }}

<form name='delete-course-form' method='POST'> </form>

<script src='https://code.jquery.com/jquery-3.6.4.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js'></script>

<script>
   document.addEventListener('DOMContentLoaded',function(){
      let courseId;
      const btnSubmit = $('.btn-submit');
      const deleteForm = document.forms['delete-course-form'];
      const containerForm = document.forms['container-form'];
      const btnDeleteCourse = document.getElementById('btn-delete-course');
      const checkboxAll = $('#checkbox-all');
      const courseItemCheckbox = $('input[name="courseIds[]"]');

      $('#delete-course-modal').on('show.bs.modal', function (event) {
         var button = $(event.relatedTarget);
         courseId = button.data('id');
         console.log(courseId) 
      });

      btnDeleteCourse.onclick = function (){
            deleteForm.action = `/courses/${courseId}?_method=DELETE`; deleteForm.submit();
      } 
      // Chọn tất cả checkbox
      checkboxAll.change(function(){
         let isCheckedAll = $(this).prop('checked');
         courseItemCheckbox.prop('checked',isCheckedAll);
         renderCheckAllSubmitButton();
      })

      // Bỏ chọn 1 checkbox
      courseItemCheckbox.change(function(){
         var isCheckedAll = courseItemCheckbox.length === $('input[name="courseIds[]"]:checked').length;
         checkboxAll.prop('checked',isCheckedAll);
         renderCheckAllSubmitButton();
      })
      // Sumbit button click

      btnSubmit.on('submit',function(e){
         const isSubmitable = $(this).hasClass('disabled');
         if(isSubmitable){
            e.preventDefault();
         }
      })

      //Re-render check all submit button
      function renderCheckAllSubmitButton(){
         const checkedCount = $('input[name="courseIds[]"]:checked').length;
         if(checkedCount > 0){
            btnSubmit.removeClass('disabled');
         }else{
            btnSubmit.addClass('disabled');
         }
      }
})

</script>